# SQLD_04(데이터 모델과 성능)

## 1. 성능 데이터 모델링의 개요

### 1.1 성능 데이터 모델링의 정의

- 데이터의 용량이 커질수록, 기업의 의사결정의 속도가 빨라질수록 데이터의 처리 속도는 빨라야할 필요가 있음
- SQL 구문이 잘못 구성되어 성능 저하가 발생 가능하지만 근본적인 디자인이 잘못되었을 수도 있음
- 성능 저하(특히 데이터 조회 부분)되는 데이터 모델의 세가지 경우
  - 데이터 모델 구조에 의한 성능 저하
  - 데이터가 대용량이 됨으로 인한 불가피한 성능 저하
  - 인덱스 특성을 충분히 고려하지 않고 인덱스를 생성함으로 인한 성능 저하
- **성능 데이터 모델링이란 DB 성능 향상을 목적으로 설계 단계의 데이터 모델링 때부터 성능과 관련된 사항이 데이터 모델링에 반영될 수 있도록 하는 것**

### 1.2 성능 데이터 모델링 수행 시점

- 성능 향상을 위한 비용은 프로젝트 수행 사전에 할수록 비용이 적음(특히 분석/설계 단계)

![image-20200505213850875](SQLD_04(데이터_모델과_성능).assets/image-20200505213850875.png)

- 분석/설계 단계에서 DB 처리 성능을 향상시킬 수 있는 방법을 고려
- 프로젝트 초기에 운영환경에 대비한 테스트 환경을 구현하고 그곳에 트랜잭션을 발생시켜 실제 성능을 테스트
- 이 때 데이터 구조도 변경하면서 어떠한 구조가 해당 사이트에 성능상 가장 적절한 구조인지를 검토하여 성능이 좋은 모습으로 디자인하는 전략이 요구

### 1.3 성능 데이터 모델링 고려사항

- 성능 데이터 모델 프로세스
  1. 데이터 모델링을 할 때 정규화를 정확하게 수행
     - 정규화된 모델이 데이터를 주요 관심사별로 분산시키는 효과로 그 자체 성능 향상
  2. DB 용량 산정을 수행
     - 용량 산정을 수행하면 어떤 테이블에 데이터가 집중되는지 파악 가능
  3. DB에 발생되는 트랜잭션의 유형 파악
     - CRUD 매트릭스를 보고 파악하는 것도 좋은 방법
     - 객체지향 모델링을 적용한다면 시퀀스 다이어그램을 보면 트랜잭션의 유형을 파악하기에 용이
     - 화면에서 처리된 데이터의 종류들을 보면 이벤트(CRUD)에 따라 테이블에 데이터가 어떻게 처리되는지를 유추 가능
     - 트랜잭션의 유형을 파악 시 SQL문장의 조인관계 테이블에서 데이터 조회의 칼럼들을 파악할 수 있게 되어 그에 따라 성능을 고려한 데이터 모델 설계 가능
  4. 용량과 트랜잭션의 유형에 따라 반정규화 수행
     - 반정규화는 테이블, 속성, 관계에 대해 포괄적인 반정규화의 방법을 적용
  5. 이력모델의 조정, PK/FK 조정, 슈퍼타입/서브타입 조정 등을 수행
     - 대량 데이터가 처리되는 이력모델에 대해 성능고려
     - PK/FK의 순서가 인덱스 특성에 따라 성능에 영향을 미치는 영향도가 크기에 반드시 PK/FK를 성능이 우수한 순서대로 칼럼의 순서를 조정
  6. 성능 관점에서 데이터 모델 검증
     - 데이터 모델 검토를 통해 다시 한 번 확인
     - 데이터 모델 규칙만을 검증하지 말고 충분하게 성능이 고려되었는지를 체크리스트에 포함하여 검증

## 2. 정규화와 성능

### 2.1 정규화를 통한 성능 향상 전략

- 정규화를 수행한다는 것은 데이터를 결정하는 결정자에 의해 함수적 종속을 가지고 있는 일반 속성을 의존자로 하여 입력/수정/삭제 이상을 제거
- 데이터 중복 속성을 제거하고 결정자에 의해 동일한 의미의 일반 속성이 하나의 테이블로 집약되므로 한 테이블의 데이터 용량이 최소화되는 효과
- 따라서 정규화된 테이블은 데이터를 처리할 때 속도가 빨라질 수도 있고 느려질 수도 있는 특성 존재

### 2.2 함수적 종속성(Functional Dependency)에 근거한 정규화 수행 필요

- 함수적 종속성은 데이터들이 어떤 기준값에 의해 종속되는 현상을 지칭

- 함수의 종속성은 데이터가 가지고 있는 근본적인 속성으로 인식
- 정규화의 궁극적인 목적은 반복적인 데이터를 분리하고 각 데이터가 종속된 테이블에 적절하게(프로세스에 의해 데이터의 정합성이 지켜질 수 있어야 함) 배치되도록 하는 것
- 기본적으로 데이터는 속성 간의 함수종속성에 근거하여 정규화
- 프로젝트 수행에서 정규화는 선택사항이 아니라 필수사항
- 정규화 이론은 건축으로 따지면 기본적인 설계 원칙만큼이나 중요한 이론
- 프로젝트에서 정규화가 적용된 모델을 설계하기 위해서는 정규화에 대한 기본이론을 정확하고 구체적으로 이해해야 함
- 전문적인 IT프로젝트를 진행하는 설계자가 정규화의 이론을 모르고 데이터 모델링을 설계하는 것은 불가능
- 정규화의 이론을 숙지하고 정보시스템의 근간인 데이터를 설계해야 함

## 3. 반정규화와 성능

### 3.1 반정규화를 통한 성능향상 전략

#### 3.1.1 반정규화의 정의

- 정규화된 엔티티, 속성, 관계에 대해 시스템의 성능 향상과 개발과 운영의 단순화를 위해 중복, 통합, 분리 등을 수행하는 데이터 모델링의 기법을 의미
- 데이터 무결성이 깨질 수 있는 위험을 무릅쓰고 데이터를 중복하여 반정규화를 적용하는 이유는 데이터를 조회할 때 디스크 I/O 양이 많아서 성능이 저하되거나 경로가 서로 멀어 조인으로 인한 성능저하가 예상되거나 칼럼을 계산하여 읽을 때 성느이 저하될 것이 예상되는 경우 반정규화를 수행
- 정규화의 함수적 종속관계는 위반하지 않지만 데이터의 중복성을 증가시켜야만 데이터 조회의 성능이 향상되는 경우 존재

#### 3.1.2 반정규화의 적용방법

- 반정규화 대상 조사
  - 범위처리빈도수 조사
  - 대량의 범위 처리 조사
  - 통계성 프로세스 조사
  - 테이블 조인 개수
- 다른 방법 유도 검토
  - 뷰(VIEW) 테이블
  - 클러스터링 적용
  - 인덱스의 조정
  - 응용애플리케이션
- 반정규화 적용
  - 테이블 반정규화
  - 속성의 반정규화
  - 관계의 반정규화

### 3.2 반정규화의 기법

#### 3.2.1 테이블 반정규화

- 테이블 병합
  - 1:1 관계 테이블 병합 : 1:1 관계를 통합하여 성능 향상
  - 1:M 관계 통합하여 성능 향상
  - 슈퍼/서브 관계를 통합하여 성능 향상

- 테이블 분할
  - 수직 분할
  - 수평 분할
- 테이블 추가
  - 중복 테이블 추가
  - 통계 테이블 추가
  - 이력 테이블 추가
  - 부분 테이블 추가

#### 3.2.2 칼럼 반정규화

- 중복 칼럼 추가
- 파생 칼럼 추가
- 이력 테이블 칼럼 추가
- PK에 의한 칼럼 추가

#### 3.2.3 관계 반정규화

- 중복관계 추가

## 4. 대량 데이터에 따른 성능

### 4.1 대량 데이터 발생에 따른 테이블 분할 개요

- 설계가 잘된 데이터 모델이라해도 대량의 데이터가 하나의 테이블에 집약되어 있고 하나의 하드웨어 공간에 저장되어 있으면 성능저하 유발
- 일의 처리되는 양이 한군데에 몰리는 현상은 어떤 업무에 있어서 중요한 업무에 해당되는 데이터가 특정 테이블에 있는 경우에 발생이 되는데 이런 경우 트랜잭션이 분산 처리될 수 있도록 테이블 단위에서 분할의 방법을 적용할 필요 존재

- 하나의 테이블에 대량의 데이터가 존재하는 경우에는 인덱스의 Tree구조가 너무 커져 효율성이 떨어져 데이터를 처리(입력, 수정, 삭제, 조회)할 때 디스크 I/O를 많이 유발
- 한 테이블에 많은 수의 칼럼이 존재하게 되면 데이터가 디스크의 여러 블록에 존재하므로 인해 디스크에서 데이터를 읽는 I/O량이 많아지게 되어 성능이 저하

- 많은 칼럼은 로우체이닝과 로우마이그레이션이 많아지게 되어 성능이 저하
  - 로우 체이닝(Row Chaining) : 로우 길이가 너무 길어서 데이터 블록 하나에 데이터가 모두 저장되지 않고 두 개 이상의 블록에 걸쳐 하나의 로우가 저장되어 있는 형태
  - 로우 마이그레이션(Row Migration) : 데이터 블록에서 수정이 발생하면 수정된 데이터를 해당 데이터 블록에서 저장하지 못하고 다른 블록의 빈 공간을 찾아 저장하는 방식
  -  로우체이닝과 로우마이그레이션이 발생하여 많은 블록에 데이터가 저장되면 데이터베이스 메모리에서 디스크와 I/O(입력/출력)가 발생할 때 불필요하게 I/O가 많이 발생하여 성능이 저하

## 5. 데이터베이스 구조와 성능

### 5.1 슈퍼/서브타입 모델의 성능 고려 방법

#### 5.1.1 슈퍼/서브타입 데이터 모델의 개요

- Extended ER모델이라고 부르는 이른바 슈퍼/서브타입 데이터 모델은 최근에 데이터 모델링을 할 때 자주 쓰이는 모델링 방법
- 공통의 부분을 슈퍼타입으로 모델링하고 공통으로부터 상속받아 다른 엔터티와 차이가 있는 속성에 대해서는 별도의 서브엔터티로 구분하여 업무의 모습을 정확하게 표현하면서 물리적인 데이터 모델로 변환을 할 때 선택의 폭을 넓힐 수 있는 장점
- 슈퍼/서브타입의 데이터 모델은 논리적인 데이터 모델에서 이용되는 형태이고 분석/설계단계를 구분하자면, 분석단계에서 많이 쓰이는 모델
- 물리적인 데이터 모델을 설계하는 단계에서는 슈퍼/서브타입 데이터 모델을 일정한 기준에 의해 변환을 해야 함
- 막연하게 슈퍼/서브타입을 아무런 기준없이 변환하는 것 자체가 성능 저하 위험 존재

#### 5.1.2 슈퍼/서브 타입 데이터 모델의 변환

- 슈퍼/서브 타입에 대한 변환을 잘못하면 성능이 저하되는 이유는 트랜잭션 특성을 고려하지 않고 테이블이 설계

  1. 트랜잭션은 항상 일괄로 처리하는데 테이블은 개별로 유지되어 Union연산에 의해 성능이 저하 가능
  2. 트랜잭션은 항상 서브타입 개별로 처리하는데 테이블은 하나로 통합되어 있어 불필요하게 많은 양의 데이터가 집약되어 있어 성능이 저하되는 경우 존재
  3. 트랜잭션은 항상 슈퍼+서브 타입을 공통으로 처리하는데 개별로 유지되어 있거나 하나의 테이블로 집약되어 있어 성능이 저하되는 경우 존재
- 해당 테이블에 발생되는 성능이 중요한 트랜잭션이 빈번하게 처리되는 기준에 따라 테이블을 설계해야 이러한 성능저하 현상을 예방 가방
-  슈퍼/서브타입을 성능을 고려한 물리적인 데이터 모델로 변환하는 기준은 데이터 양과 해당 테이블에 발생되는 트랜잭션의 유형에 따라 결정
- 데이터용량이 많아지는 경우 그리고 해당 업무적인 특징이 성능에 민감한 경우는 트랜잭션이 해당 테이블에 어떻게 발생되는지에 따라 3가지 변환방법을 참조하여 상황에 맞게 변환

#### 5.1.3 슈퍼/서브 타입 데이터 모델의 변환 기술

- 논리적인 데이터 모델에서 설계한 슈퍼타입/서브타입 모델을 물리적인 데이터 모델로 전환할 때 주로 어떤 유형의 트랜잭션이 발생하는지 검증
- 데이터량이 많이 존재하고 지속적으로 증가하는 양도 많다면 슈퍼타입/서브타입에 대해 물리적인 데이터 모델로 변환하는 세 가지 유형에 대해 세심하게 적용
  1. 개별로 발생되는 트랜잭션에 대해서는 개별 테이블로 구성
  2.  슈퍼타입+서브타입에 대해 발생되는 트랜잭션에 대해서는 슈퍼타입+서브타입 테이블로 구성
  3. 전체를 하나로 묶어 트랜잭션이 발생할 때는 하나의 테이블로 구성

#### 5.1.4 슈퍼/서브 타입 데이터 모델의 변환 타입 비교

|                구분                |            OneToOne Type             |                     Plus Type                     |               Single Type               |
| :--------------------------------: | :----------------------------------: | :-----------------------------------------------: | :-------------------------------------: |
|                특징                |           개별 테이블 유지           |               슈퍼+서브 타입 테이블               |              하나의 테이블              |
|               확장성               |                 우수                 |                       보통                        |                  나쁨                   |
|              조인성능              |                 나쁨                 |                       나쁨                        |                  나쁨                   |
|             I/O량 성능             |                 좋음                 |                       좋음                        |                  나쁨                   |
|            관리 용이성             |               좋지않음               |                     좋지않음                      |                좋음(1개)                |
| 트랜잭션 유형에<br> 따른 선택 방법 | 개별 테이블로 접근<br>많은 경우 선택 | 슈퍼+서브 형식으로<br>데이터를 처리하는 경우 선택 | 전체를 일괄적으로<br>처리하는 경우 선택 |

## 6. 분산 데이터베이스와 성능

### 6.1 분산 데이터베이스 정의

- 여러 곳으로 분산되어있는 데이터베이스를 하나의 가상 시스템으로 사용할 수 있도록 한 데이터베이스

- 논리적으로 동일한 시스템에 속하지만, 컴퓨터 네트워크를 통해 물리적으로 분산되어 있는 데이터들의 모임. 

  물리적 Site 분산, 논리적으로 사용자 통합·공유

- 즉, 분산 데이터베이스는 **데이터베이스를 연결하는 빠른 네트워크 환경을 이용하여 데이터베이스를 여러 지역 여러 노드로 위치시켜 사용성/성능 등을 극대화 시킨 데이터베이스**라고 정의할 수 있음

### 6.2 분산 데이터베이스의 투명성

- 분산 데이터베이스가 되기 위한 6가지 투명성
  - 분할 투명성(단편화)
  - 위치 투명성
  - 지역사상 투명성
  - 중복 투명성
  - 장애 투명성
  - 병행 투명성

### 6.3 분산 데이터베이스의 적용 방법 및 장단점

#### 6.3.1 분산 데이터베이스 적용 방법

- 업무 흐름을 보고 업무구성에 따른 아키텍처 특징에 따라 데이터베이스 구성
- 단순히 분산 환경에서 데이터베이스를 구축하는 것이 목적이 아니라, 업무의 특징에 따라 데이터베이스 분산구조를 선택적으로 설계하는 능력이 필요
- 데이터베이스 분산 설계라는 측면보다는 데이터베이스 구조설계(아키텍처)라는 의미로 이해해도 무방

#### 6.3.2 분산 데이터베이스 장단점

| <center>장 점</center>                                       | <center>단 점</center>                                       |
| ------------------------------------------------------------ | :----------------------------------------------------------- |
| - 지역 자치성, 점증적 시스템 용량 확장<br>- 신뢰성과 가용성<br>- 효용성과 융통성<br>- 빠른 응답 속도와 통신비용 절감<br>- 데이터의 가용성과 신뢰성 증가<br>- 시스템 규모의 적절한 조절<br>- 각 지역 사용자의 요구 수용 증대 | - 소프트웨어 개발 비용<br>- 오류의 잠재성 증대<br>- 처리 비용의 증대<br>- 설계, 관리의 복잡성과 비용<br>- 불규칙한 으답 속도<br>- 통제의 어려움<br>- 데이터 무결서에 대한 위협 |

### 6.4 분산 데이터베이스의 활용 방향성

- 분산 데이터베이스는 업무적인 기능이 다양해지고 데이터의 양이 기하급수적으로 증가하는 최근 데이터베이스 환경에서 적용하는 고급화된 기술
- 업무적인 특징에 따라 분산 데이터베이스를 활용하는 기술이 필요

### 6.5 데이터베이스 분산구성의 가치

- 데이터를 분산 환경으로 구성하였을 때 가장 핵심적인 가치는 바로 통합된 데이터베이스에서 제공할 수 없는 빠른 성능을 제공
- 원거리 또는 다른 서버에 접속하여 처리하므로 인해 발생되는 네트워크 부하 및 트랜잭션 집중에 따른 성능 저하의 원인을 분산된 데이터베이스 환경을 구축하므로 빠른 성능을 제공하는 것이 가능

### 6.6 분산 데이터베이스의 적용 기법

- 테이블 위치 분산
- 테이블 분할
- 테이블 복제
- 테이블 요약 분산
# Cluster

## 5.1 운영 환경을 위한 설정과 클러스터 구성

### 5.1.1 노드 설정과 노드 역할

- **노드 역할**
  - ES에는 역할(role)이라는 개념이 있음
  - **클러스터 구성을 위해서는 반드시 노드에 역할 부여 필요**
  - 지정된 역할에 따라 노드가 클러스터 내에서 어떤 작업을 담당할지 정해짐
  - **주요 노드 역할**
    - 마스터 후보(master-eligible)
      - 노드의 역할에 master를 지정하면 해당 노느는 마스터 후보가 됨
      - 마스터 후보 노드 중에서 선거를 통해 마스터 노드 선출
      - 마스터 노드는 클러스터 관리 역할
    - 데이터 노드
      - 실제 데이터를 들고 있는 노드
    - 인제스트(ingest)
      - 데이터가 색인되기 전에 전처리를 수행하는 인제스트 파이프라인을 수행하는 노드
    - 조정 노드
      - 클라이언트의 요청을 받아서 다른 노드에 요청을 분배하고 클라이언트에게 최종 응답을 돌려주는 노드
      - 기본적으로 모든 노드가 조정 역할을 수행하지만, 마스터나 데이터 등 주요 역할을 수행하지 않고 조정 역할만 수행하는 노드는 조정 전용 노드라 불림
    - 원격 클러스터 클라이언트 노드
      - 다른 ES 클러스터에 클라이언트로 붙을 수 있는 노드
      - 노드 역할에 remote_cluster_client를 추가해 지정
    - 데이터 티어 노드
      - 데이터 노드를 용도 및 성능별로 hot-warm-cold-frozen 티어로 구분해 저장하는 데이터 티어 구조 채택 시 사용하는 역할
      - data 역할 대신 `data_content`, `data_hot`, `data_warm`, `data_cold`, `data_frozen` 역할 선택

### 5.1.2 그 외 필요한 주요 설정

- **힙 크기**
  - 적절한 힙 크기 지정은 중요한 사항
    1. 최소한 시스템 메모리의 절반 이하로 지정
    2. 32GB 이상 지정하지 않아야함 - 
  - `config/jvm.options`를 열어 지정 (7.11 버전 이후 직접 수정하는 것보다 `config/jvm.options.d` 디렉터리 밑에 별도 파일 을 새로 생성해 힙 크기를 지정하는 것이 편함)
  - `Xms`, `Xmx`를 같은 크기로 지정

- **스와핑**
  - ES는 스와핑이 성능과 노드 안정성에 큰 영향을 미치므로, 스와핑을 사용하지 않도록 강력히 권고
  - 공식 문서에서는 스와핑을 켜느니 차라리 운영체제가 노드를 kill 시키도록 놔두는 것이 낫다고 가이드